{"ast":null,"code":"import { createMachine, assign } from 'xstate';\nimport moment from 'moment';\nexport const audioMachine = createMachine({\n  id: 'audio_player',\n  initial: 'begin',\n  context: {\n    image: 'https://is5-ssl.mzstatic.com/image/thumb/Podcasts116/v4/e4/a3/c6/e4a3c61d-7195-9431-f6a9-cf192f9c803e/mza_4615863570753709983.jpg/100x100bb.jpg',\n    title: 'This is the selected podcast title',\n    scrolling: false,\n    eq: true,\n    src: `https://pdst.fm/e/chrt.fm/track/479722/arttrk.com/p/CRMDA/claritaspod.com/measure/pscrb.fm/rss/p/stitcher.simplecastaudio.com/9aa1e238-cbed-4305-9808-c9228fc6dd4f/episodes/d2a175f2-db09-480b-992d-d54b71c4c972/audio/128/default.mp3?aid=rss_feed&awCollectionId=9aa1e238-cbed-4305-9808-c9228fc6dd4f&awEpisodeId=d2a175f2-db09-480b-992d-d54b71c4c972&feed=dxZsm5kX`\n  },\n  states: {\n    begin: {\n      invoke: {\n        src: 'loadAudio',\n        onDone: [{\n          target: 'idle.loaded',\n          actions: 'assignResultsToContext'\n        }]\n      }\n    },\n    idle: {\n      initial: 'loaded',\n      states: {\n        loaded: {\n          on: {\n            OPEN: {\n              target: '#audio_player.opened',\n              actions: 'assignSourceToContext'\n            },\n            CHANGE: {\n              target: '#audio_player.idle.loaded',\n              actions: 'assignSourceToContext'\n            }\n          }\n        }\n      }\n    },\n    replay: {\n      invoke: {\n        src: 'clearAudio',\n        onDone: [{\n          target: 'opened'\n        }]\n      }\n    },\n    opened: {\n      invoke: {\n        src: 'startAudio',\n        onDone: [{\n          target: '.playing'\n        }],\n        onError: [{\n          target: '.error'\n        }]\n      },\n      on: {\n        CLOSE: {\n          target: 'idle',\n          actions: 'clearPlayer'\n        }\n      },\n      states: {\n        error: {\n          invoke: {\n            src: 'loadAudio',\n            onDone: [{\n              target: '#audio_player.opened',\n              actions: 'assignResultsToContext'\n            }]\n          }\n        },\n        playing: {\n          on: {\n            PAUSE: {\n              target: 'paused',\n              actions: 'pausePlayer'\n            },\n            COORDS: {\n              target: 'playing',\n              actions: 'assignCoordsToContext'\n            },\n            PROGRESS: {\n              target: 'playing',\n              actions: 'assignProgressToContext'\n            },\n            SEEK: {\n              target: 'playing',\n              actions: 'seekPlayer'\n            },\n            ERROR: {\n              target: 'error',\n              actions: 'turnEqOff'\n            },\n            OPEN: {\n              target: '#audio_player.replay',\n              actions: ['assignSourceToContext']\n            }\n          }\n        },\n        paused: {\n          on: {\n            PAUSE: {\n              target: 'playing',\n              actions: 'playPlayer'\n            }\n          }\n        }\n      }\n    }\n  }\n}, {\n  actions: {\n    clearPlayer: assign((context, event) => {\n      context.player.pause();\n      return {\n        src: null,\n        progress: null,\n        currentTime: 0,\n        duration: 0,\n        current_time_formatted: '0:00'\n      };\n    }),\n    pausePlayer: assign((context, event) => {\n      context.player.pause();\n    }),\n    playPlayer: assign((context, event) => {\n      context.player.play();\n    }),\n    seekPlayer: assign((context, event) => {\n      context.player.currentTime = event.value;\n    }),\n    assignProgressToContext: assign((context, event) => {\n      const {\n        currentTime,\n        duration,\n        coords\n      } = event;\n      const current_time_formatted = !currentTime ? '0:00' : moment.utc(currentTime * 1000).format('mm:ss');\n      const duration_formatted = !duration ? '0:00' : moment.utc(duration * 1000).format('mm:ss');\n      return {\n        currentTime,\n        current_time_formatted,\n        duration_formatted,\n        duration,\n        progress: currentTime / duration * 100\n      };\n    }),\n    assignCoordsToContext: assign((context, event) => {\n      return {\n        coords: event.coords\n      };\n    }),\n    turnEqOff: assign((context, event) => {\n      context.player.pause();\n      return {\n        eq: false,\n        player: null\n      };\n    }),\n    turnEqOn: assign((context, event) => {\n      context.player.pause();\n      return {\n        eq: true,\n        player: null\n      };\n    }),\n    assignResultsToContext: assign((context, event) => {\n      return {\n        player: event.data\n      };\n    }),\n    assignSourceToContext: assign((context, event) => {\n      var _event$title;\n      return {\n        ...event,\n        src: event.value,\n        scrolling: ((_event$title = event.title) === null || _event$title === void 0 ? void 0 : _event$title.length) > 35\n      };\n    })\n  }\n});","map":{"version":3,"names":["createMachine","assign","moment","audioMachine","id","initial","context","image","title","scrolling","eq","src","states","begin","invoke","onDone","target","actions","idle","loaded","on","OPEN","CHANGE","replay","opened","onError","CLOSE","error","playing","PAUSE","COORDS","PROGRESS","SEEK","ERROR","paused","clearPlayer","event","player","pause","progress","currentTime","duration","current_time_formatted","pausePlayer","playPlayer","play","seekPlayer","value","assignProgressToContext","coords","utc","format","duration_formatted","assignCoordsToContext","turnEqOff","turnEqOn","assignResultsToContext","data","assignSourceToContext","length"],"sources":["/home/miltonejones/projects/state-cast/src/machines/audioMachine.js"],"sourcesContent":["import { createMachine, assign } from 'xstate';\r\nimport moment from 'moment';\r\n\r\nexport const audioMachine = createMachine(\r\n  {\r\n    id: 'audio_player',\r\n    initial: 'begin',\r\n    context: {\r\n      image:\r\n        'https://is5-ssl.mzstatic.com/image/thumb/Podcasts116/v4/e4/a3/c6/e4a3c61d-7195-9431-f6a9-cf192f9c803e/mza_4615863570753709983.jpg/100x100bb.jpg',\r\n      title: 'This is the selected podcast title',\r\n      scrolling: false,\r\n      eq: true,\r\n      src: `https://pdst.fm/e/chrt.fm/track/479722/arttrk.com/p/CRMDA/claritaspod.com/measure/pscrb.fm/rss/p/stitcher.simplecastaudio.com/9aa1e238-cbed-4305-9808-c9228fc6dd4f/episodes/d2a175f2-db09-480b-992d-d54b71c4c972/audio/128/default.mp3?aid=rss_feed&awCollectionId=9aa1e238-cbed-4305-9808-c9228fc6dd4f&awEpisodeId=d2a175f2-db09-480b-992d-d54b71c4c972&feed=dxZsm5kX`,\r\n    },\r\n    states: {\r\n      begin: {\r\n        invoke: {\r\n          src: 'loadAudio',\r\n          onDone: [\r\n            {\r\n              target: 'idle.loaded',\r\n              actions: 'assignResultsToContext',\r\n            },\r\n          ],\r\n        },\r\n      },\r\n      idle: {\r\n        initial: 'loaded',\r\n        states: {\r\n          loaded: {\r\n            on: {\r\n              OPEN: {\r\n                target: '#audio_player.opened',\r\n                actions: 'assignSourceToContext',\r\n              },\r\n              CHANGE: {\r\n                target: '#audio_player.idle.loaded',\r\n                actions: 'assignSourceToContext',\r\n              },\r\n            },\r\n          },\r\n        },\r\n      },\r\n\r\n      replay: {\r\n        invoke: {\r\n          src: 'clearAudio',\r\n          onDone: [\r\n            {\r\n              target: 'opened',\r\n            },\r\n          ],\r\n        },\r\n      },\r\n\r\n      opened: {\r\n        invoke: {\r\n          src: 'startAudio',\r\n          onDone: [\r\n            {\r\n              target: '.playing',\r\n            },\r\n          ],\r\n          onError: [\r\n            {\r\n              target: '.error',\r\n            },\r\n          ],\r\n        },\r\n        on: {\r\n          CLOSE: {\r\n            target: 'idle',\r\n            actions: 'clearPlayer',\r\n          },\r\n        },\r\n        states: {\r\n          error: {\r\n            invoke: {\r\n              src: 'loadAudio',\r\n              onDone: [\r\n                {\r\n                  target: '#audio_player.opened',\r\n                  actions: 'assignResultsToContext',\r\n                },\r\n              ],\r\n            },\r\n          },\r\n          playing: {\r\n            on: {\r\n              PAUSE: {\r\n                target: 'paused',\r\n                actions: 'pausePlayer',\r\n              },\r\n              COORDS: {\r\n                target: 'playing',\r\n                actions: 'assignCoordsToContext',\r\n              },\r\n              PROGRESS: {\r\n                target: 'playing',\r\n                actions: 'assignProgressToContext',\r\n              },\r\n              SEEK: {\r\n                target: 'playing',\r\n                actions: 'seekPlayer',\r\n              },\r\n              ERROR: {\r\n                target: 'error',\r\n                actions: 'turnEqOff',\r\n              },\r\n              OPEN: {\r\n                target: '#audio_player.replay',\r\n                actions: ['assignSourceToContext'],\r\n              },\r\n            },\r\n          },\r\n          paused: {\r\n            on: {\r\n              PAUSE: {\r\n                target: 'playing',\r\n                actions: 'playPlayer',\r\n              },\r\n            },\r\n          },\r\n        },\r\n      },\r\n    },\r\n  },\r\n  {\r\n    actions: {\r\n      clearPlayer: assign((context, event) => {\r\n        context.player.pause();\r\n        return {\r\n          src: null,\r\n          progress: null,\r\n          currentTime: 0,\r\n          duration: 0,\r\n          current_time_formatted: '0:00',\r\n        };\r\n      }),\r\n      pausePlayer: assign((context, event) => {\r\n        context.player.pause();\r\n      }),\r\n      playPlayer: assign((context, event) => {\r\n        context.player.play();\r\n      }),\r\n      seekPlayer: assign((context, event) => {\r\n        context.player.currentTime = event.value;\r\n      }),\r\n      assignProgressToContext: assign((context, event) => {\r\n        const { currentTime, duration, coords } = event;\r\n        const current_time_formatted = !currentTime\r\n          ? '0:00'\r\n          : moment.utc(currentTime * 1000).format('mm:ss');\r\n\r\n        const duration_formatted = !duration\r\n          ? '0:00'\r\n          : moment.utc(duration * 1000).format('mm:ss');\r\n        return {\r\n          currentTime,\r\n          current_time_formatted,\r\n          duration_formatted,\r\n          duration,\r\n          progress: (currentTime / duration) * 100,\r\n        };\r\n      }),\r\n      assignCoordsToContext: assign((context, event) => {\r\n        return {\r\n          coords: event.coords,\r\n        };\r\n      }),\r\n      turnEqOff: assign((context, event) => {\r\n        context.player.pause();\r\n        return {\r\n          eq: false,\r\n          player: null,\r\n        };\r\n      }),\r\n      turnEqOn: assign((context, event) => {\r\n        context.player.pause();\r\n        return {\r\n          eq: true,\r\n          player: null,\r\n        };\r\n      }),\r\n      assignResultsToContext: assign((context, event) => {\r\n        return {\r\n          player: event.data,\r\n        };\r\n      }),\r\n      assignSourceToContext: assign((context, event) => {\r\n        return {\r\n          ...event,\r\n          src: event.value,\r\n          scrolling: event.title?.length > 35,\r\n        };\r\n      }),\r\n    },\r\n  }\r\n);\r\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}